# 第一章 计算机系统概述

------

## 1.1 计算机发展历程

 ###  1.1.1 计算机硬件的发展

1. 计算机的四代变化
   - 第一代计算机（1946 - 1957）—— 电子管时代，特点：
     - 逻辑元件采用电子管；
     - 使用机器语言进行编程；
     - 主存用延迟线或磁鼓存储信息，容量极小；
     - 体积庞大成本高；
     - 运算速度慢，几千次到几万次每秒。
   - 第二代计算机（1958 - 1964）—— 晶体管时代，特点：
     - 逻辑元件采用晶体管；
     - 运算速度高到几万次到几十万次每秒；
     - 主存使用磁芯存储器；
     - 计算机软件得以发展，开始出现高级语言及其编译程序，有了操作系统雏形。
   - 第三代计算机（1965 - 1971）—— 中小规模集成电路时代，特点：
     - 逻辑元件采用中小规模集成电路；
     - 半导体存储器开始取代磁芯存储器；
     - 高级语言发展迅速，操作系统进一步发展，开始有了分时操作系统。
   - 第四代计算机（1972 - 至今）—— 超大规模集成电路时代，特点：
     - 逻辑元件采用大规模集成电路和超大规模集成电路，产生了微处理器；
     - 并行、流水线、高速缓存和虚拟存储器等概念用在了这代计算机中。
2. 计算机元件的更新换代
   - 摩尔定律
   - 半导体存储器的发展
   - 微处理器发展

### 1.1.2 计算机软件的发展

计算机软件技术的蓬勃发展，也为计算机系统的发展做出了很大的贡献。

------

## 1.2 计算机系统层次结构

###  1.2.1 计算机系统的组成

> 硬件系统和软件系统共同构成了一个完整的计算机系统。对某一功能来说，既可以用软件实现，也可以用硬件实现，我们称这一功能为软硬件在逻辑功能上是等价的。

------

###  1.2.2 计算机硬件

1. 冯·诺依曼机基本思想

   - 采用“存储程序”的工作方式。
   - 计算机硬件系统由运算器、控制器、存储器、输入接口和输出接口5打部件组成。
   - 指令和数据以同等地位存储在存储器中，形式上没有区别，但计算机应能区分它们。
   - 指令和数据均以二进制代码表示。

   “存储程序”的基本思想：将事先编制好的程序和原始数据送入主存后才能执行，一旦程序被启动执行，就无须操作人员的干预，计算机会自动逐条执行指令，直至程序执行结束。

2. 计算机的功能部件

   - 输入接口

     > 输入设备连接输入接口，主要功能是将程序和数据以机器所能识别和接受的信息形式输入计算机。如，键盘。

   - 输出接口

     > 输出设备连接输出接口，主要功能是将计算机处理的结果以人们所能接受的形式或其他系统所要求的信息形式输出。如，显示器。

   - 存储器

     存储器分为主存（内存）和辅存（外存）。

     - 主存：CPU能够直接访问的存储器，按存储单元的地址进行存取。

       - 存储单元：包含若干存储元件，每个存储元件存储一位二进制代码，一个存储单元存储的一串代码称为一个存储字，其位数称为存储字长。
       - MAR（地址寄存器）：存放访存地址，位数表示存储单元的数量，10位地址寄存器表示有2^10=1024=1K个存储单元，其长度与PC长度相等。
       - MDR（数据寄存器）：暂存要从存储器中读或写的数据，其位数与存储字长相等，一般为字节（8bit）的2次幂整数倍。

       MAR和MDR虽然是存储器的一部分，但在现代计算机中确实存在于CPU中的；后文提到的高速缓存（Cache）也在CPU中。

     - 辅存：帮助主存记忆更多的信息，辅存的信息必须调入主存后才能被CPU访问。

   - 运算器

     运算器是计算机的执行单元，用于进行逻辑运算（与、或、非、异或、比较、移位等）和算数运算（加、减、乘、除）。
   
     - 算数逻辑单元（Arithmetic and Logic Unit，ALU）：运算器的核心。
     - 累加器（ACC）：运算器必须，计算加法
     - 乘商寄存器（MQ）：运算器必须，计算乘除
     - 操作数寄存器（X）：运算器必须，存放操作数
     - 变址寄存器（IX）
     - 基址寄存器（BR）
     - 程序状态寄存器（PSW）：也称标志寄存器，用于存放ALU运算得到的一些标志信息或处理机的状态信息，如结果是否溢出、有无产生进位或借位、结果是否为负等。
   
   - 控制器
   
     控制器是计算机的指挥中心，由其控制其余各部件自动协调地进行工作。
   
     - 控制单元（CU）：字面意义，发出指令控制各部件工作。
   
     - 程序控制器（PC）：存放下一条执行的指令地址，具有自动加“1”的功能（“1”指指令的长度），它与主存的MAR之间有一条直接通路。
     - 指令寄存器（IR）：用来存放当前的指令，其内容来自主存的MDR。指令中的操作码OP(IR)送至CU，用以分析指令并发出各种微操作命令序列；地址码Ad(IR)送往MAR用以取操作数。
   
   一般运算器和控制器集成到同一个芯片上，称为中央处理器（CPU）。CPU和主存共同构成主机，其余的硬件装置（外存、IO设备等）统称为外部设备，简称外设。

###  1.2.3 计算机软件

1. 系统软件和应用软件

   - 系统软件：一组保证计算机系统高效、正确运行的基础软件，通常作为系统资源提供给用户使用。
     - 操作系统（OS）
     - 数据库管理系统（DBMS）
     - 语言处理程序
     - 分布式软件系统
     - 网络软件系统
     - 标准库程序
     - 服务性程序
   - 应用软件：用户为解决某个领域中的各类问题而编制的程序。
     - 科学计算类程序
     - 工程设计类程序
     - 数据统计与处理程序

2. 三个级别语言

   - 机器语言：二进制代码语言，计算机唯一可以直接识别和执行的语言。
   - 汇编语言：用英文单词或其缩写代替二进制的指令代码。
   - 高级语言：如C、C++、Java等，为方便程序设计人员写出解决问题的处理方案和解题过程的程序，

   汇编语言和高级语言都需要转换为机器语言才能被计算机识别和执行，这个过程是翻译程序来实现的，翻译程序包括：

   - 汇编程序：将汇编语言翻译成机器语言。
   - 解释程序：将源程序中的语句按顺序逐条翻译成机器语言，翻译一条执行一条。
   - 编译程序：将高级语言的源程序一次性翻译成汇编语言或机器语言，再执行。

###  1.2.4 计算机系统的层次结构

> 没有配备软件的纯硬件被称为裸机。第3层～第5层称为虚拟机层，是由软件实现的机器，虚拟机只对该层的观察者存在。下层是上层的基础，上层是下层的扩展。

1. 微程序机器层：实际的硬件层，由硬件直接执行微指令。
2. 传统机器层：实际的机器层，由微程序解释机器指令系统。
3. 操作系统层：操作系统程序实现。由机器指令和广义指令组成，这一层称为混合层。
4. 汇编语言层：为用户提供一种符号话的语言，借此可编写汇编语言源程序。
5. 高级语言层：面向用户，为方便用户编写应用程序而设置的。

###  1.2.5 计算机系统的工作原理

1. “存储程序”的工作方式

   每条指令的执行过程包括：

   - 从主存取指令

   - 对指令进行译码
   - 计算下条指令地址
   - 取操作数并执行
   - 将结果送回存储器

2. 从源程序到可执行文件（hello.c -> hello）

   - 预处理阶段：预处理器（cpp）对源程序中以字符#开头的命令进行处理。
   - 编译阶段：编译器（ccl）对预处理后的源程序进行编译，生成汇编语言程序。
   - 汇编阶段：汇编器（as）将上一阶段生成的汇编语言程序汇编成机器语言指令。
   - 链接阶段：链接器（ld）将多个可重定位目标文件和标准库函数合并为一个可执行目标文件。

3. 程序执行过程描述

   > unix> ./hello
   >
   > Hello, world!
   >
   > unix>

   - shell程序将键盘输入的每个字符逐一读入CPU寄存器。
   - 将其保存到主存中，在主存的缓冲区形成字符串“./hello”。
   - 接收到Enter键时，shell调出操作系统的内核程序，由内核来加载磁盘上的可执行文件hello到主存中。
   - 内核加载完可执行文件的代码和数据后，将hello的第一条指令的地址送至PC，CPU随后开始执行hello程序，它将已加载到主存的字符串“hello,world!\n”中的每个字符从主存取到CPU的寄存器中。
   - 然后将CPU寄存器中的字符串送到显示器。

4. 指令执行过程的描述

   以取数指令为例（送至运算器中的ACC中）：

   - 取指令：PC->MAR->M->MDR->IR
   - 分析指令：OP(IR)->CU
   - 执行指令：Ad(IR)->MAR->M->MDR->ACC

------

##  1.3 计算机的性能指标

###  1.3.1 计算机的主要性能指标

1. 字长：指计算机进行一次整数运算所能处理的二进制数据的位数。

2. 数据通路带宽：指数据总线一次所能并行传送信息的位数。

3. 主存容量：主存储器所能存储信息的最大容量，通常以字节来衡量，也可以用字数*字长（512K * 16）来表示。

4. 运算速度

   - 吞吐量和响应时间

     - 吞吐量：指系统在单位时间内处理请求的数量，主要取决于主存的存取周期。
     - 响应时间：指从用户向计算机发送一个请求，到系统对该请求做出响应并获得所需结果的等待时间。

   - 主频和CPU时钟周期

     - 主频（CPU时钟频率）：机器内部的时钟频率。常见的有1.8GHz、2.4GHz、2.8GHz。
     - CPU时钟周期：通常为节拍脉冲或T周期，即主频的倒数，是CPU中的最小时间单位，执行指令的每个动作至少需要一个时钟周期。

   - CPI（Cycle Per Instruction）：一条指令所需的时钟周期数。

   - CPU执行时间：指运行一个程序所需的时间

     CPU执行时间=CPU时钟周期数 * CPU时钟周期=(指令条数*CPI)/主频

   - MIPS（Million Instructions Per Second）：每秒执行多少百万条指令

     MIPS = 主频 / (CPI * 10^6)

   - MFLOPS、GFLOPS、TFLOPS、PFLOPS、EFLOPS和ZFLOPS

     - MFLOPS：每秒执行多少百万条浮点运算。
     - GFLOPS：每秒执行多少十亿次浮点运算。
     - TFLOPS：每秒执行多少万亿次浮点运算。
     - PFLOPS：每秒执行多少10^15次浮点运算。
     - EFLOPS：每秒执行多少10^18次浮点运算。
     - ZFLPOPS：每秒执行多少10^21次浮点运算。





